{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Change Request Document",
  "description": "Schema for describing a set of code changes, including a summary, detailed thought process, and file-level modifications, designed for automated code generation and review systems.",
  "type": "object",
  "required": [
    "title",
    "summary",
    "thoughtProcess",
    "changes"
  ],
  "additionalProperties": false,
  "x-layout": "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6 bg-gray-50 rounded-lg shadow-md",
  "properties": {
    "title": {
      "type": "string",
      "description": "A concise and descriptive title summarizing the overall change request. Should be clear and to the point.",
      "minLength": 10,
      "maxLength": 120,
      "x-order": 10,
      "x-classNames": "col-span-full mb-4"
    },
    "summary": {
      "type": "string",
      "description": "A high-level explanation of the overall change request, its primary purpose, and the problem it solves or the feature it implements.",
      "minLength": 50,
      "maxLength": 1000,
      "x-order": 20,
      "x-classNames": "col-span-full md:col-span-1 mb-4"
    },
    "thoughtProcess": {
      "type": "string",
      "description": "Detailed reasoning behind the changes, the approach taken, design decisions, and any alternatives considered. Explain 'why' certain choices were made.",
      "minLength": 100,
      "x-order": 30,
      "x-classNames": "col-span-full md:col-span-1 mb-4"
    },
    "documentation": {
      "type": "string",
      "description": "Optional extended notes in Markdown format. May include in-depth design decisions, complex implementation details, usage instructions, or future recommendations/considerations. Useful for persistent documentation.",
      "minLength": 50,
      "x-order": 40,
      "x-classNames": "col-span-full mb-4"
    },
    "buildScripts": {
      "type": "object",
      "description": "A mapping of script labels (e.g., 'install', 'build', 'test') to their respective shell commands. Provide this when new dependencies are introduced, or when existing build/run/test scripts need to be updated or added.",
      "minProperties": 1,
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": {
          "type": "string",
          "description": "The shell command to execute for the given script label.",
          "minLength": 1,
          "x-order": 1,
          "x-classNames": "font-mono text-sm bg-gray-100 p-2 rounded"
        }
      },
      "additionalProperties": false,
      "x-order": 50,
      "x-classNames": "col-span-full md:col-span-1 mb-4"
    },
    "changes": {
      "type": "array",
      "description": "A list of individual file modifications, additions, or deletions to be applied to the project.",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "filePath",
          "action"
        ],
        "additionalProperties": false,
        "x-layout": "grid grid-cols-1 md:grid-cols-2 gap-4 border p-4 rounded-md bg-white shadow-sm",
        "properties": {
          "filePath": {
            "type": "string",
            "description": "The path to the file relative to the project root (e.g., 'src/utils/helpers.js' or 'public/index.html').",
            "minLength": 3,
            "pattern": "^(?!/)(?!.*//)(?!.*/$)[a-zA-Z0-9_./-]*[a-zA-Z0-9_-]+$",
            "x-order": 10,
            "x-classNames": "font-mono text-blue-700"
          },
          "action": {
            "type": "string",
            "enum": [
              "add",
              "modify",
              "delete",
              "repair",
              "analyze"
            ],
            "description": "The type of operation to be performed on the file. 'analyze' implies reviewing content without making direct modifications in this step.",
            "x-order": 20,
            "x-classNames": "uppercase text-xs font-bold text-gray-600"
          },
          "newContent": {
            "type": "string",
            "description": "The full content of the file after the 'add', 'modify', or 'repair' action. This string must be correctly JSON-escaped.",
            "minLength": 1,
            "x-order": 30,
            "x-classNames": "col-span-full font-mono text-sm bg-gray-50 p-3 rounded-md overflow-auto"
          },
          "reason": {
            "type": "string",
            "description": "An optional explanation in Markdown for why this specific file change was made, detailing its local impact or purpose.",
            "minLength": 20,
            "x-order": 40,
            "x-classNames": "col-span-full italic text-gray-700"
          }
        },
        "allOf": [
          {
            "if": {
              "properties": {
                "action": {
                  "const": "delete"
                }
              }
            },
            "then": {
              "not": {
                "required": [
                  "newContent"
                ]
              },
              "properties": {
                "newContent": {
                  "notDefined": true
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "action": {
                  "enum": [
                    "add",
                    "modify",
                    "repair"
                  ]
                }
              }
            },
            "then": {
              "required": [
                "newContent"
              ]
            }
          },
          {
            "if": {
              "properties": {
                "action": {
                  "const": "analyze"
                }
              }
            },
            "then": {
              "not": {
                "required": [
                  "newContent"
                ]
              },
              "properties": {
                "newContent": {
                  "notDefined": true
                }
              }
            }
          }
        ]
      },
      "x-order": 60,
      "x-classNames": "col-span-full mb-4"
    },
    "gitInstructions": {
      "type": "array",
      "description": "Optional list of specific git commands (e.g., 'git add .', 'git commit -m \"Refactor code\"', 'git push origin feature-branch') to execute after applying the changes. Useful for automated workflows.",
      "items": {
        "type": "string",
        "minLength": 5
      },
      "uniqueItems": true,
      "minItems": 1,
      "x-order": 70,
      "x-classNames": "col-span-full md:col-span-1 mb-4"
    }
  }
}