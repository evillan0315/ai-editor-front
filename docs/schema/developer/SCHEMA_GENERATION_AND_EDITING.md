# Schema Generation and Editing for Developers

This document guides developers on how to use the AI Schema Generator feature in the Project Board frontend to define and manage JSON schemas. The feature allows for both AI-powered generation from natural language instructions and detailed manual definition via a property editor.

The primary component for this functionality is `src/components/schema/AiSchemaGenerator.tsx`.

## Key Components

-   **`AiSchemaGenerator.tsx`**: The main interface for schema definition.
-   **`SchemaInstructionGenerator.tsx`**: Handles AI-powered schema generation.
-   **`SchemaPropertiesEditor.tsx`**: Provides a detailed UI for manual schema definition.
-   **`SchemaPropertyField.tsx`**: A recursive component for editing individual schema properties and their nested children.
-   **`GeneratedSchemaViewer.tsx`**: Displays the resulting JSON schema in a CodeMirror editor and offers a dynamic form preview.

## 1. AI-Powered Schema Generation

The `AiSchemaGenerator` provides a toggle labeled "Generate Schema from Instruction". When enabled, you can define your schema by providing a natural language prompt.

### How to use:

1.  Navigate to the Schema Generator page.
2.  Toggle "Generate Schema from Instruction" to `on`.
3.  In the "Instruction" text area, describe the JSON schema you want to create. Be as detailed as possible about:
    -   The overall purpose (`title`, `description`).
    -   Required properties.
    -   Data types (string, number, boolean, array, object).
    -   Formats (date, email, uuid).
    -   Enums (allowed values).
    -   Min/Max values or lengths.
    -   Nested structures (objects within objects, arrays of objects).
    -   **Important**: You can also instruct the AI to include UI-hinting `x-` properties (e.g., `x-order`, `x-classNames`, `x-layout`, `x-multiline`) to influence how the schema will render in the Dynamic Form Builder. For example: "Make the 'description' field multiline" (for `x-multiline: true`) or "Place 'firstName' and 'lastName' on the same row in a 2-column grid" (for `x-layout: 'grid grid-cols-2 gap-4'`).
4.  Click "Generate Schema from Instruction". The AI will process your request and update the "Generated Schema" viewer with the resulting JSON schema.
5.  Optionally, use the "Apply Generated Schema To Instruction" feature to inject the currently displayed JSON schema into the instruction input, which can be useful for iterating on AI-generated schemas or using an existing schema as a base for further AI modification.

## 2. Manual Schema Definition

When the "Generate Schema from Instruction" toggle is `off`, the `SchemaPropertiesEditor` is displayed, allowing you to define schemas field by field.

### Top-Level Schema Metadata

At the top of the editor, you can define global metadata for your JSON schema:

-   **Schema ID (`$id`)**: A unique URI for the schema.
-   **Meta-Schema URL (`$schema`)**: The URI of the JSON Schema draft that the schema adheres to (default: `http://json-schema.org/draft-07/schema#`).
-   **Schema Title**: A human-readable title for the schema.
-   **Schema Description**: A detailed explanation of the schema's purpose.
-   **x-layout (Tailwind) (Top-level container)**: Tailwind CSS classes to control the layout of the top-level form generated by `DynamicFormBuilder`. E.g., `grid grid-cols-12 gap-4`.

### Adding and Editing Properties

Properties are managed using `SchemaPropertyField` components, which recursively handle nested structures.

-   **Add Top-Level Property**: Click "Add Top-Level Property" to add a new field to your schema.
-   **Property Name**: The key for the property in the JSON schema.
-   **Type**: Select the data type (string, number, boolean, array, object, null).
-   **Required**: Toggle if the field is mandatory.
-   **Toggle Advanced Options (Eye icon)**: Shows/hides advanced JSON Schema keywords and custom `x-` properties.
-   **Toggle Children (Arrow icon)**: For `object` and `array` types, this shows/hides the nested properties or item schema editor.

#### Advanced Options (`property.showOptions`)

When advanced options are visible, you can configure:

-   **Description**: Detailed text for the property.
-   **Default Value**: A default value that will be pre-filled in dynamic forms.
-   **Format**: Semantic meaning for strings (e.g., `date`, `email`, `uuid`).
-   **Enum**: A comma-separated list of allowed values for the property.
-   **Minimum / Maximum**: Numeric constraints.
-   **Min Length / Max Length**: String length constraints.
-   **Pattern (RegEx)**: Regular expression for string validation.
-   **x-multiline**: If checked, for `string` types, the `DynamicFormBuilder` will render a multiline `TextField` (textarea).
-   **x-order (for UI sorting)**: A numeric hint for the `DynamicFormBuilder` to sort properties visually. Lower numbers appear first.
-   **x-classNames (Tailwind)**: Tailwind CSS classes applied directly to the Material UI component wrapper for this specific field (e.g., `col-span-6`). This allows fine-grained control over individual field styling and width.
-   **x-layout (Tailwind) (for object/array children)**: Tailwind CSS classes to control the layout of the *children* properties within an `object` or the `items` within an `array`. For example, if an object has `x-layout: 'grid grid-cols-2 gap-4'`, its properties will be arranged in a 2-column grid.

#### Nested Properties (`property.showChildren`)

-   **For `object` types**:
    -   Toggle "Show Nested Fields" (Arrow icon).
    -   Click "Add Object Property" to add properties specific to this nested object. These properties will also have their own full set of options and can be further nested.
-   **For `array` types**:
    -   Toggle "Show Nested Fields" (Arrow icon).
    -   Click "Define Array Item Schema" to define the schema for *each element* within the array. This is a single `SchemaPropertyField` representing the structure of a single item. If the items are objects, this nested field will itself allow adding `properties`.

### Generating and Saving the Schema

-   **Generate Schema from Manual Input**: After defining your properties, click this button to convert your UI input into a JSON schema and update the `GeneratedSchemaViewer`.
-   **Create Schema (to Backend)**: Once you are satisfied with your schema, click this button to save the generated JSON schema to the backend database. This allows for persistence and reuse across the application (e.g., for dynamically generated forms for project creation).

This editor provides a comprehensive way to both rapidly prototype schemas using AI and precisely control their definition and UI rendering through manual input and custom `x-` properties.
